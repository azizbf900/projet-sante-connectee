<?xml version="1.0" encoding="UTF-8"?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.chart.LineChart?>
<?import javafx.scene.chart.CategoryAxis?>
<?import javafx.scene.chart.NumberAxis?>
<BorderPane xmlns:fx="http://javafx.com/fxml" fx:controller="tn.esprit.controller.DashboardController" stylesheets="@dashboard.css">
    <left>
        <VBox spacing="24.0" alignment="TOP_CENTER" style="-fx-background-color: linear-gradient(to bottom, #1976d2, #63a4ff); -fx-effect: dropshadow(gaussian, #1565c0, 8, 0.2, 0, 2); -fx-border-width: 0 2 0 0; -fx-border-color: #1565c0;" prefWidth="220.0">
            <padding><Insets top="36" left="10" right="10" bottom="10"/></padding>
            <Label text="Tableau de bord Admin" style="-fx-text-fill: white; -fx-font-size: 24px; -fx-font-weight: bold; -fx-effect: dropshadow(gaussian, #000000AA, 2, 0.6, 0, 1);" />
            <Button text="Utilisateurs" fx:id="usersBtn" style="-fx-background-color: #2196f3; -fx-text-fill: white; -fx-font-size: 16px; -fx-background-radius: 20; -fx-font-weight: bold; -fx-effect: dropshadow(gaussian, #1976d2, 2, 0.2, 0, 1);" />
            <Button text="Statistiques" fx:id="statsBtn" style="-fx-background-color: #1976d2; -fx-text-fill: white; -fx-font-size: 16px; -fx-background-radius: 20; -fx-font-weight: bold; -fx-effect: dropshadow(gaussian, #1976d2, 2, 0.2, 0, 1);" />
            <Button text="Journal d'activité" fx:id="activityLogBtn" style="-fx-background-color: #ffa000; -fx-text-fill: white; -fx-font-size: 15px; -fx-background-radius: 20; -fx-font-weight: bold; -fx-effect: dropshadow(gaussian, #ffa000, 2, 0.2, 0, 1); -fx-padding: 10 0 10 0;" />
            <!-- Add more navigation buttons here -->
            <VBox fx:id="sidebarSpacer" VBox.vgrow="ALWAYS"/>
            <Button text="Chatbot Santé" fx:id="chatbotBtn" style="-fx-background-color: #43a047; -fx-text-fill: white; -fx-font-size: 15px; -fx-background-radius: 20; -fx-font-weight: bold; -fx-effect: dropshadow(gaussian, #388e3c, 2, 0.2, 0, 1); -fx-padding: 10 0 10 0;" />
            <VBox fx:id="sidebarSpacer2" VBox.vgrow="ALWAYS"/>
            <Button text="Déconnexion" fx:id="logoutBtn" style="-fx-background-color: #d32f2f; -fx-text-fill: white; -fx-font-size: 15px; -fx-background-radius: 20; -fx-font-weight: bold; -fx-effect: dropshadow(gaussian, #00000055, 2, 0.2, 0, 1); -fx-padding: 10 0 10 0;" />
        </VBox>
    </left>
    <center>
        <VBox spacing="24.0" alignment="TOP_CENTER" style="-fx-background-color: #f4f8fb; -fx-padding: 24 0 0 0;">
            <Label text="Gérer les utilisateurs" style="-fx-font-size: 22px; -fx-font-weight: bold; -fx-text-fill: #1976d2; -fx-padding: 0 0 14 0;" />
            <HBox spacing="8" alignment="CENTER_LEFT" style="-fx-padding: 0 0 10 0;">
                <Label text="Rechercher:" style="-fx-font-size: 14px; -fx-text-fill: #1976d2; -fx-font-weight: bold;" />
                <TextField fx:id="searchField" promptText="Rechercher par nom d'utilisateur ou email..." style="-fx-pref-width: 220px; -fx-background-radius: 14; -fx-font-size: 14px;" />
            </HBox>
            <StackPane fx:id="mainContentPane" style="-fx-pref-width: 740; -fx-pref-height: 400;">
                <VBox fx:id="userTablePane" visible="true" managed="true" spacing="0">
                    <TableView fx:id="userTable" prefWidth="700.0" prefHeight="320.0" maxHeight="320.0" styleClass="table-view" style="-fx-background-radius: 10; -fx-effect: dropshadow(gaussian, #1976d2, 2, 0.1, 0, 1);">
                        <columns>
                            <TableColumn text="ID" fx:id="idCol" prefWidth="60.0" />
                            <TableColumn text="Nom d'utilisateur" fx:id="usernameCol" prefWidth="140.0" />
                            <TableColumn text="Email" fx:id="emailCol" prefWidth="200.0" />
                            <TableColumn text="Créé le" fx:id="createdAtCol" prefWidth="140.0" />
                            <TableColumn text="Actions" fx:id="actionsCol" prefWidth="180.0" />
                        </columns>
                    </TableView>
                    <Pagination fx:id="pagination" maxPageIndicatorCount="10" />
                </VBox>
                <!-- Activity Log TableView moved to its own pane -->
                <VBox fx:id="activityLogPane" visible="false" managed="false" spacing="10" alignment="TOP_CENTER" style="-fx-padding: 16 0 0 0;">
                    <Label text="Journal d'activité des utilisateurs" style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #1976d2;" />
                    <TableView fx:id="activityLogTable" prefWidth="700.0" prefHeight="200.0" styleClass="table-view" style="-fx-background-radius: 10;">
                        <columns>
                            <TableColumn fx:id="logIdCol" text="ID" prefWidth="50.0" />
                            <TableColumn fx:id="logUserIdCol" text="User ID" prefWidth="70.0" />
                            <TableColumn fx:id="logActionCol" text="Action" prefWidth="100.0" />
                            <TableColumn fx:id="logDetailsCol" text="Details" prefWidth="200.0" />
                            <TableColumn fx:id="logTimestampCol" text="Timestamp" prefWidth="180.0" />
                        </columns>
                    </TableView>
                </VBox>
                <VBox fx:id="statsPane" visible="false" managed="false" alignment="TOP_CENTER" spacing="18" style="-fx-padding: 30 18 18 18;">
                    <Label text="Inscriptions des utilisateurs par date" style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #1976d2;" />
                    <LineChart fx:id="userLineChart" title="Inscriptions des utilisateurs par date" animated="false">
                        <xAxis>
                            <CategoryAxis fx:id="dateAxis" label="Date" />
                        </xAxis>
                        <yAxis>
                            <NumberAxis fx:id="countAxis" label="Nombre d'utilisateurs" />
                        </yAxis>
                    </LineChart>
                </VBox>
            </StackPane>
        </VBox>
    </center>
</BorderPane>
